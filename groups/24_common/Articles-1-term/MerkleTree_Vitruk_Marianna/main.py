#программа проекта

from merkletree import MerkleTree
import time

def main():
    print("запуск программы 'дерево меркла':\n")
    
    # 1. пример
    print("1. пример")
    print("покупки:")
    покупки = ["хлеб 50р", "молоко 80р", "сыр 200р", "йогурт 60р"]
    for item in покупки:
        print(f"- {item}")
    print("\nстроим дерево...")
    дерево1 = MerkleTree(покупки)
    корень1 = дерево1.получить_корень()
    print(f"\nкорень дерева: {корень1[:12]}...")
    print(f"длина хэша: {len(корень1)} символа\n")
    print("проверка:")
    if дерево1.проверить("хлеб 50р"):
        print("хлеб 50р - найден")
    else:
        print("хлеб 50р - не найден")
    if дерево1.проверить("шоколад 100р"):
        print("шоколад 100р - найден")
    else:
        print("шоколад 100р - не найден")
    print("\n" + "-" * 40)
    
    # 2. пример из блокчейна
    print("2. пример из блокчейна\n")
    print("транзакции:")
    транзакции = [
        "TX1: анна → борис: 1 BTC",
        "TX2: борис → виктор: 0.5 BTC"
    ]
    for tx in транзакции:
        print(tx)
    print("\nстроим дерево для блока...")
    дерево2 = MerkleTree(транзакции)
    корень2 = дерево2.получить_корень()
    print(f"\nкорень: {корень2[:16]}...")
    проверка_транзакция = "TX2: борис → виктор: 0.5 BTC"
    if дерево2.проверить(проверка_транзакция):
        print(f"проверка TX2: есть в блоке")
    else:
        print(f"проверка TX2: нет в блоке")
    print("\n" + "-" * 40)
    
    # 3. пример
    print("3. пример\n")
    документы = ["паспорт 123456", "диплом 654321", "снилс 987654"]
    print("исходные документы:")
    for doc in документы:
        print(f"- {doc}")
    print("\nстроим исходное дерево...")
    исходное_дерево = MerkleTree(документы)
    исходный_корень = исходное_дерево.получить_корень()
    print(f"исходный корень: {исходный_корень[:12]}...")
    print("\nдокумент 'паспорт 123456' изменён на 'паспорт 999999'")
    измененные_документы = ["паспорт 999999", "диплом 654321", "снилс 987654"]
    print("\nстроим новое дерево...")
    новое_дерево = MerkleTree(измененные_документы)
    новый_корень = новое_дерево.получить_корень()
    print(f"новый корень: {новый_корень[:12]}...")
    if исходный_корень != новый_корень:
        print("изменение обнаружено!")
    else:
        print("ошибка: изменение не обнаружено")
    print("\n" + "-" * 40)
    
    # 4. скорость работы
    print("4. скорость работы\n")
    print("тестируем скорость построения...")
    тестовые_данные = [f"элемент {i}" for i in range(1000)]
    start_time = time.time()
    тестовое_дерево = MerkleTree(тестовые_данные)
    build_time = time.time() - start_time
    print(f"построение дерева из 1000 элементов: {build_time:.3f} сек")
    print("\nтестируем скорость проверки...")
    проверяемый_элемент = "элемент 500"
    start_time = time.time()
    for _ in range(100):
        тестовое_дерево.проверить(проверяемый_элемент)
    verify_time = (time.time() - start_time) / 100
    print(f"проверка элемента в дереве из 1000 элементов: {verify_time:.5f} сек")
    print("\nдля 1 млн транзакций:")
    print("без дерева: 1 млн проверок")
    print("с деревом: ~20 проверок (log₂(1,000,000) ≈ 20)")
    print("\n" + "=" * 40)
    print("программа завершена")

if __name__ == "__main__":
    main()